{% extends 'admin/base_admin.html.twig' %}

{% block title %}Mise à jour Catégorie | BiblioTech{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette de couleurs élégante et sombre */
            --primary: #9333ea;
            --primary-dark: #7e22ce;
            --primary-light: #c084fc;
            --secondary: #0ea5e9;
            --secondary-dark: #0284c7;
            --accent: #f43f5e;
            --accent-dark: #e11d48;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --dark-soft: #1e293b;
            --dark-lighter: #334155;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --gray-dark: #475569;
            --gold: #fbbf24;
            --gold-dark: #d97706;

            /* Ombres élégantes */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 15px rgba(147, 51, 234, 0.5);

            /* Transitions et animations */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);

            /* Bordures et rayons */
            --border-radius: 0.5rem;
            --border-radius-lg: 0.75rem;
            --border-radius-xl: 1rem;
            --border-radius-full: 9999px;
        }

        /* Styles globaux */
        body {
            background-color: #0f172a;
            color: var(--light);
            font-family: 'Montserrat', sans-serif;
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            letter-spacing: -0.02em;
        }

        /* Navbar élégante avec effet glassmorphism */
        .admin-navbar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .navbar-logo {
            height: 42px;
            width: 42px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            box-shadow: var(--shadow), 0 0 10px rgba(147, 51, 234, 0.5);
            position: relative;
            overflow: hidden;
        }

        .navbar-logo::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                    rgba(255, 255, 255, 0.2),
                    rgba(255, 255, 255, 0)
            );
            transform: rotate(30deg);
            pointer-events: none;
        }

        .navbar-title {
            font-weight: 700;
            font-size: 1.25rem;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            margin: 0;
            font-family: 'Playfair Display', serif;
        }

        .navbar-subtitle {
            font-size: 0.75rem;
            color: var(--gray-light);
            margin: 0;
            letter-spacing: 0.5px;
            font-weight: 300;
        }

        .navbar-menu {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .navbar-item {
            position: relative;
        }

        .navbar-link {
            color: var(--gray-light);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 0;
            position: relative;
            transition: var(--transition);
            font-size: 0.9rem;
            letter-spacing: 0.3px;
        }

        .navbar-link:hover, .navbar-link.active {
            color: var(--primary-light);
        }

        .navbar-link.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--border-radius-full);
            box-shadow: 0 0 8px rgba(147, 51, 234, 0.5);
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: var(--border-radius-lg);
            transition: var(--transition);
        }

        .navbar-user:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-full);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: var(--shadow), 0 0 10px rgba(147, 51, 234, 0.3);
        }

        .user-info {
            display: none;
        }

        @media (min-width: 768px) {
            .user-info {
                display: block;
            }
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--light);
            margin: 0;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--gray-light);
            margin: 0;
        }

        .navbar-dropdown {
            position: relative;
        }

        .dropdown-toggle {
            background: none;
            border: none;
            color: var(--gray-light);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .dropdown-toggle:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--light);
        }

        /* Conteneur principal avec effet de profondeur */
        .content-container {
            padding: 2rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Conteneur du formulaire avec glassmorphism */
        .category-form-container {
            max-width: 700px;
            margin: 0 auto;
            padding: 2.5rem;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .category-form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
        }

        .category-form-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, rgba(147, 51, 234, 0), rgba(147, 51, 234, 0.5), rgba(147, 51, 234, 0));
        }

        /* Titre du formulaire */
        .form-title {
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--light) 0%, var(--gray-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            position: relative;
            letter-spacing: -0.02em;
        }

        .form-title i {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        /* Groupes de formulaire */
        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }

        .form-label {
            font-weight: 500;
            color: var(--gray-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: block;
            transition: var(--transition);
        }

        .required-field::after {
            content: " *";
            color: var(--accent);
            font-size: 1rem;
        }

        .form-control {
            background-color: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 0.875rem 1.25rem;
            color: var(--light);
            font-size: 0.875rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.2);
            background-color: rgba(30, 41, 59, 0.7);
        }

        .form-control::placeholder {
            color: var(--gray);
        }

        .form-control[readonly] {
            background-color: rgba(15, 23, 42, 0.7);
            opacity: 0.8;
        }

        .form-control.is-invalid {
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.2);
        }

        .invalid-feedback {
            display: none;
            color: var(--accent);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        .was-validated .form-control:invalid ~ .invalid-feedback,
        .form-control.is-invalid ~ .invalid-feedback {
            display: block;
        }

        /* Input group pour le slug */
        .input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-outline-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-light);
            padding: 0.875rem;
            border-radius: var(--border-radius-lg);
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .btn-outline-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        .btn-outline-secondary::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0));
            transform: rotate(30deg);
            transition: var(--transition);
        }

        .btn-outline-secondary:hover::after {
            transform: rotate(30deg) translate(10%, 10%);
        }

        /* Description textarea */
        .form-control[rows] {
            resize: vertical;
            min-height: 100px;
        }

        /* Actions du formulaire */
        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2.5rem;
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: var(--border-radius-full);
            font-weight: 600;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--gray-dark) 0%, var(--gray) 100%);
            border: none;
            color: var(--light);
            box-shadow: var(--shadow);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md), 0 0 10px rgba(100, 116, 139, 0.3);
            filter: brightness(1.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            color: white;
            box-shadow: var(--shadow), 0 0 10px rgba(147, 51, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md), 0 0 20px rgba(147, 51, 234, 0.5);
            filter: brightness(1.1);
        }

        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0));
            transform: rotate(30deg);
            transition: var(--transition);
        }

        .btn:hover::after {
            transform: rotate(30deg) translate(10%, 10%);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(147, 51, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0); }
        }

        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Form text */
        .form-text {
            color: var(--gray);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Responsive adjustments */
        @media (max-width: 576px) {
            .category-form-container {
                padding: 1.5rem;
            }

            .form-title {
                font-size: 1.5rem;
            }

            .form-actions {
                flex-direction: column;
                gap: 0.75rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
{% endblock %}

{% block admin_body %}
    <!-- Navbar Élégante avec Glassmorphism -->
    <nav class="admin-navbar">
        <div class="navbar-container">
            <a href="{{ path('app_admin_dashboard') }}" class="navbar-brand">
                <div class="navbar-logo">
                    <i class="fas fa-book"></i>
                </div>
                <div>
                    <h1 class="navbar-title">BiblioTech</h1>
                    <p class="navbar-subtitle">Gestion Élégante</p>
                </div>
            </a>

            <div class="navbar-menu">
                <div class="navbar-item">
                    <a href="{{ path('app_admin_dashboard') }}" class="navbar-link">
                        <i class="fas fa-home me-1"></i> Accueil
                    </a>
                </div>
                <div class="navbar-item">
                    <a href="{{ path('app_admin_livre_all') }}" class="navbar-link">
                        <i class="fas fa-book-open me-1"></i> Livres
                    </a>
                </div>
                <div class="navbar-item">
                    <a href="{{ path('app_admin_categorie_all') }}" class="navbar-link active">
                        <i class="fas fa-tags me-1"></i> Catégories
                    </a>
                </div>
                <div class="navbar-item">
                    <a href="#" class="navbar-link">
                        <i class="fas fa-users me-1"></i> Utilisateurs
                    </a>
                </div>
                <div class="navbar-item">
                    <a href="#" class="navbar-link">
                        <i class="fas fa-cog me-1"></i> Paramètres
                    </a>
                </div>
            </div>

            <div class="navbar-user">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <p class="user-name">Admin</p>
                    <p class="user-role">Administrateur</p>
                </div>
                <div class="navbar-dropdown">
                    <button class="dropdown-toggle">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteneur Principal -->
    <div class="content-container fade-in">
        <div class="category-form-container">
            <h1 class="form-title">
                <i class="fas fa-tag me-2"></i>Mise à jour d'une catégorie
            </h1>

            {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}

            <div class="form-group">
                {{ form_label(form.libelle, null, {'label_attr': {'class': 'form-label required-field'}}) }}
                {{ form_widget(form.libelle, {
                    'attr': {
                        'class': 'form-control',
                        'required': 'required',
                        'placeholder': 'Ex: Roman, Science-Fiction, etc.'
                    }
                }) }}
                {{ form_errors(form.libelle, {'attr': {'class': 'invalid-feedback'}}) }}
                <div class="invalid-feedback">Veuillez saisir un nom de catégorie.</div>
            </div>

            <div class="form-group">
                {{ form_label(form.slug, null, {'label_attr': {'class': 'form-label required-field'}}) }}
                <div class="input-group">
                    {{ form_widget(form.slug, {
                        'attr': {
                            'class': 'form-control',
                            'readonly': 'readonly',
                            'required': 'required'
                        }
                    }) }}
                    <button class="btn btn-outline-secondary" type="button" id="edit-slug">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
                {{ form_errors(form.slug, {'attr': {'class': 'invalid-feedback'}}) }}
                <div class="invalid-feedback">Veuillez vérifier le slug.</div>
                <small class="form-text">Le slug est généré automatiquement mais peut être modifié.</small>
            </div>

            <div class="form-group">
                {{ form_label(form.description, null, {'label_attr': {'class': 'form-label'}}) }}
                {{ form_widget(form.description, {
                    'attr': {
                        'class': 'form-control',
                        'rows': 3,
                        'placeholder': 'Description de la catégorie (optionnel)'
                    }
                }) }}
                {{ form_errors(form.description, {'attr': {'class': 'invalid-feedback'}}) }}
            </div>

            <div class="form-actions">
                <a href="{{ path('app_admin_categorie_all') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Annuler
                </a>
                <button type="submit" class="btn btn-primary pulse" id="submit-btn">
                    <i class="fas fa-save me-2"></i>Enregistrer
                </button>
            </div>

            {{ form_end(form) }}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        _.

        document.addEventListener('DOMContentLoaded', function() {
            // Validation du formulaire
            const form = document.querySelector('.needs-validation');
            const submitBtn = document.getElementById('submit-btn');

            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    form.classList.add('was-validated');
                }
            }, false);

            // Gestion des champs
            const libelleField = document.getElementById('{{ form.libelle.vars.id }}');
            const slugField = document.getElementById('{{ form.slug.vars.id }}');
            const editSlugBtn = document.getElementById('edit-slug');

            let slugEditable = false;

            function generateSlug(text) {
                return text
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^\w\s-]/g, '')
                    .replace(/[\s]+/g, '-')
                    .replace(/[-]+/g, '-')
                    .trim();
            }

            // Génération automatique du slug
            libelleField.addEventListener('input', function() {
                if (!slugEditable && libelleField.value) {
                    slugField.value = generateSlug(libelleField.value);
                }
            });

            // Activation/Désactivation de l'édition du slug
            editSlugBtn.addEventListener('click', function() {
                slugEditable = !slugEditable;
                slugField.readOnly = !slugEditable;
                slugField.style.backgroundColor = slugEditable ? 'rgba(30, 41, 59, 0.7)' : 'rgba(15, 23, 42, 0.7)';
                this.innerHTML = slugEditable
                    ? '<i class="fas fa-lock"></i>'
                    : '<i class="fas fa-edit"></i>';
            });

            // Initialisation du slug si libellé non vide
            if (libelleField.value && !slugField.value) {
                slugField.value = generateSlug(libelleField.value);
            }

            // Validation des champs requis
            submitBtn.addEventListener('click', function() {
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        field.classList.remove('is-invalid');
                    }
                });
            });

            // Animation des champs lors de la saisie
            const inputs = document.querySelectorAll('.form-control');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.closest('.form-group').querySelector('.form-label').style.color = 'var(--primary-light)';
                });
                input.addEventListener('blur', function() {
                    this.closest('.form-group').querySelector('.form-label').style.color = 'var(--gray-light)';
                });
            });

            // Effet de survol sur les boutons
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.boxShadow = '0 0 15px rgba(147, 51, 234, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3)';
                });
                button.addEventListener('mouseleave', function() {
                    this.style.boxShadow = this.classList.contains('btn-primary')
                        ? '0 0 10px rgba(147, 51, 234, 0.3), 0 4px 6px -1px rgba(0, 0, 0, 0.2)'
                        : '0 4px 6px -1px rgba(0, 0, 0, 0.2)';
                });
            });
        });
    </script>
{% endblock %}